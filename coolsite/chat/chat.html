<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Site Chat</title>
  <style>
    body {
      font-family: Helvetica, Arial, sans-serif;
      background-color: #1a1a1a;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    #chat-container {
      width: 400px;
      height: 500px;
      background-color: #2a2a2a;
      border-radius: 10px;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }

    #messages {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      padding-right: 5px;
    }

    .message {
      padding: 5px 10px;
      margin-bottom: 5px;
      background-color: #3a3a3a;
      border-radius: 6px;
      word-wrap: break-word;
    }

    #input-container {
      display: flex;
    }

    #messageInput {
      flex: 1;
      padding: 8px;
      border-radius: 6px 0 0 6px;
      border: none;
      outline: none;
      font-size: 14px;
      background-color: #1a1a1a;
      color: #fff;
    }

    #sendBtn {
      padding: 8px 15px;
      border: none;
      background-color: #6a3960;
      color: #fff;
      border-radius: 0 6px 6px 0;
      cursor: pointer;
    }

    #sendBtn:hover {
      background-color: #8a5a80;
    }
  </style>
</head>
<body>

<div id="chat-container">
  <div id="messages"></div>
  <div id="input-container">
    <input type="text" id="messageInput" placeholder="Type a message...">
    <button id="sendBtn">Send</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>

<!-- CryptoJS for encryption -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<script>
  // ====== Firebase Setup ======
    const firebaseConfig = {
    apiKey: "AIzaSyDugRe7mcrBcaRsmuvXIYNQzYlYlnwejvI",
    authDomain: "website-chat-7fdbc.firebaseapp.com",
    projectId: "website-chat-7fdbc",
    storageBucket: "website-chat-7fdbc.firebasestorage.app",
    messagingSenderId: "125461335959",
    appId: "1:125461335959:web:88d0d806b8cdaaaf307ed2",
    measurementId: "G-QZTCPNBMBG"
    };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ====== Encryption Setup ======
  const secretKey = "my-secret-key"; // Change this for your own security

  function encrypt(msg) {
    return CryptoJS.AES.encrypt(msg, secretKey).toString();
  }

  function decrypt(ciphertext) {
    return CryptoJS.AES.decrypt(ciphertext, secretKey).toString(CryptoJS.enc.Utf8);
  }

  // ====== Elements ======
  const input = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");
  const messagesDiv = document.getElementById("messages");

  // ====== Send Message ======
  function sendMessage() {
    const msg = input.value.trim();
    if (!msg) return;
    const encrypted = encrypt(msg);
    db.ref("chat").push().set({ text: encrypted });
    input.value = "";
  }

  sendBtn.addEventListener("click", sendMessage);
  input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
  });

  // ====== Receive Messages ======
  db.ref("chat").on("child_added", snapshot => {
    const encrypted = snapshot.val().text;
    const msg = decrypt(encrypted);
    const div = document.createElement("div");
    div.classList.add("message");
    div.textContent = msg;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight; // auto-scroll
  });
</script>

</body>
</html>
